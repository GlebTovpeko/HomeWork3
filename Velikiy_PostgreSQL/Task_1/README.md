# üîß –ó–∞–¥–∞–Ω–∏–µ 1




# –û—Ç—á–µ—Ç –ø–æ –∑–∞–¥–∞–Ω–∏—é Task_1: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ PostgreSQL

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#1-–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–¶–µ–ª–∏ –∑–∞–¥–∞–Ω–∏—è](#2-—Ü–µ–ª–∏-–∑–∞–¥–∞–Ω–∏—è)
3. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#3-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
4. [–•–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç](#4-—Ö–æ–¥-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è-—Ä–∞–±–æ—Ç)
   - [4.1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–ü—É–Ω–∫—Ç 1.0)](#41-—Å–æ–∑–¥–∞–Ω–∏–µ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è-–∏-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö-–ø—É–Ω–∫—Ç-10)
   - [4.2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π (–ü—É–Ω–∫—Ç 1.1)](#42-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ-–º–æ–¥—É–ª–µ–π-–ø—É–Ω–∫—Ç-11)
   - [4.3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–ü—É–Ω–∫—Ç 1.2)](#43-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è-–ø—É–Ω–∫—Ç-12)
   - [4.4. –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ pgbench (–ü—É–Ω–∫—Ç 1.3)](#44-–Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-pgbench-–ø—É–Ω–∫—Ç-13)
   - [4.5. –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (–ü—É–Ω–∫—Ç 1.4)](#45-–∞–Ω–∞–ª–∏–∑-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏-–∑–∞–ø—Ä–æ—Å–æ–≤-–ø—É–Ω–∫—Ç-14)
   - [4.6. –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ (–ü—É–Ω–∫—Ç 1.5)](#46-–∞–Ω–∞–ª–∏–∑-–ª–æ–≥–æ–≤-–ø—É–Ω–∫—Ç-15)
   - [4.7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞ (–ü—É–Ω–∫—Ç—ã 1.6, 1.7)](#47-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏-–∏-–¥–æ—Å—Ç—É–ø–∞-–ø—É–Ω–∫—Ç—ã-16-17)
5. [–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Ansible](#5-–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è-—á–µ—Ä–µ–∑-ansible)
6. [–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](#6-—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
7. [–ó–∞–∫–ª—é—á–µ–Ω–∏–µ](#7-–∑–∞–∫–ª—é—á–µ–Ω–∏–µ)

---

## 1. –í–≤–µ–¥–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è **Task_1** –≤ —Ä–∞–º–∫–∞—Ö –∫—É—Ä—Å–∞ "–ö–ú–ë –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ". –¶–µ–ª—å—é —Ä–∞–±–æ—Ç—ã —è–≤–ª—è–µ—Ç—Å—è —É–≥–ª—É–±–ª–µ–Ω–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π PostgreSQL 16: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏. –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å –ø–æ–º–æ—â—å—é **Ansible**.

---

## 2. –¶–µ–ª–∏ –∑–∞–¥–∞–Ω–∏—è

1.  –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `pgbench` —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `bench`.
2.  –ü–æ–¥–∫–ª—é—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ (`pg_stat_statements` –∏ –¥—Ä.).
3.  –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
4.  –ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é —É—Ç–∏–ª–∏—Ç—ã `pgbench`.
5.  –í—ã—è–≤–∏—Ç—å —Å–∞–º—ã–µ —Ä–µ—Å—É—Ä—Å–æ–µ–º–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã (–ø–æ IO –∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è) —á–µ—Ä–µ–∑ `pg_stat_statements`.
6.  –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ `pgbench`.
7.  –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø —Å –¥—Ä—É–≥–∏—Ö —É–∑–ª–æ–≤.

---

## 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–†–∞–±–æ—Ç–∞ –ø—Ä–æ–≤–æ–¥–∏–ª–∞—Å—å –Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏–∑ –¥–≤—É—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω —Å –û–° Debian 13, —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã—Ö –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∑–∞–¥–∞–Ω–∏–∏ (Task_0):

| –•–æ—Å—Ç | IP-–∞–¥—Ä–µ—Å | –†–æ–ª—å |
|------|----------|------|
| `server1` | 192.168.122.19 | –û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Master) |
| `server2` | 192.168.122.75 | –ö–ª–∏–µ–Ω—Ç / –†–µ–ø–ª–∏–∫–∞ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞) |

–ù–∞ —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –º–∞—à–∏–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Ansible, –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–æ—Å—Ç—É–ø –ø–æ SSH –∏ Ansible Vault –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤.

---

## 4. –•–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç

### 4.1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–ü—É–Ω–∫—Ç 1.0)

–ë—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã:
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: `bench`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `pgbench` —Å –ø–∞—Ä–æ–ª–µ–º.
- –ü—Ä–∞–≤–∞: –ü–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `pgbench` –Ω–∞ –±–∞–∑—É `bench`.

**–ö–æ–º–∞–Ω–¥–∞ Ansible:**
```yaml
- name: Create database bench
  become_user: postgres
  command: psql -c "CREATE DATABASE bench;"

- name: Create user pgbench
  become_user: postgres
  command: psql -c "CREATE USER pgbench WITH PASSWORD '...';"
```

*–í—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥ `\du` –∏ `\l`, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–π —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤, –æ—Ç–æ–±—Ä–∞–∂—ë–Ω –≤ –æ—Ç—á—ë—Ç–µ.*

---

### 4.2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π (–ü—É–Ω–∫—Ç 1.1)

–î–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –°–£–ë–î –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç `postgresql-contrib-16` –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `pg_stat_statements`, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤.

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `postgresql.conf`:**
```ini
shared_preload_libraries = 'pg_stat_statements'
pg_stat_statements.max = 10000
pg_stat_statements.track = all
```

**–ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤ –ë–î:**
```sql
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;
```

*–í—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã `\dx` –∏–ª–∏ –∑–∞–ø—Ä–æ—Å–∞ –∫ `pg_extension`, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π –∞–∫—Ç–∏–≤–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `pg_stat_statements`, –æ—Ç–æ–±—Ä–∞–∂—ë–Ω –≤ –æ—Ç—á—ë—Ç–µ.*

*(–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∏ –¥—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏ –∏–∑ –ø–∞–∫–µ—Ç–∞ contrib, –Ω–∞–ø—Ä–∏–º–µ—Ä `pg_buffercache`).*

---

### 4.3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–ü—É–Ω–∫—Ç 1.2)

–î–ª—è –∞—É–¥–∏—Ç–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏ –≤–∫–ª—é—á–µ–Ω–æ –ø–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `postgresql.conf`:**
```ini
log_statement = 'all'              # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã
log_duration = on                  # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
log_min_duration_statement = 0     # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–∂–µ –±—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã
log_line_prefix = '%t [%p]: ...'   # –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø—Ä–µ—Ñ–∏–∫—Å–∞ –ª–æ–≥–∞
```

*–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ `SHOW log_statement;`, –æ—Ç–æ–±—Ä–∞–∂—ë–Ω–∞ –≤ –æ—Ç—á—ë—Ç–µ.*

---

### 4.4. –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ pgbench (–ü—É–Ω–∫—Ç 1.3)

–° –ø–æ–º–æ—â—å—é —É—Ç–∏–ª–∏—Ç—ã `pgbench` –ø—Ä–æ–≤–µ–¥–µ–Ω–æ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ—Å—Ç–∞:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: `pgbench -i -s 10 bench` (–º–∞—Å—à—Ç–∞–± 10).
- –ó–∞–ø—É—Å–∫: `pgbench -c 4 -j 2 -t 100 bench` (4 –∫–ª–∏–µ–Ω—Ç–∞, 2 –ø–æ—Ç–æ–∫–∞, 100 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞).


*–í—ã–≤–æ–¥ —É—Ç–∏–ª–∏—Ç—ã pgbench —Å –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ TPS (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É) –∏ –∑–∞–¥–µ—Ä–∂–µ–∫ (latency), –æ—Ç–æ–±—Ä–∞–∂—ë–Ω –≤ –æ—Ç—á—ë—Ç–µ.*

---

### 4.5. –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (–ü—É–Ω–∫—Ç 1.4)

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω –∞–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è `pg_stat_statements` –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —Å–∞–º—ã—Ö —Ç—è–∂–µ–ª—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

**–¢–æ–ø-5 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –¥–∏—Å–∫ (IO Write):**
```sql
SELECT query, calls, blk_write_time 
FROM pg_stat_statements 
ORDER BY blk_write_time DESC LIMIT 5;
```

**–¢–æ–ø-5 —Å–∞–º—ã—Ö –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (Execution Time):**
```sql
SELECT query, calls, total_exec_time 
FROM pg_stat_statements 
ORDER BY total_exec_time DESC LIMIT 5;
```

*–°–ø–∏—Å–æ–∫ —Å–∞–º—ã—Ö –¥–æ–ª–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç–æ–±—Ä–∞–∂—ë–Ω –≤ –æ—Ç—á—ë—Ç–µ.*

---

### 4.6. –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ (–ü—É–Ω–∫—Ç 1.5)

–ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏ PostgreSQL –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø–∏—Å–µ–π –æ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ `pgbench`. –ë–ª–∞–≥–æ–¥–∞—Ä—è –Ω–∞—Å—Ç—Ä–æ–π–∫–µ `log_statement = 'all'`, –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω.

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞:**
```bash
grep "pgbench" /var/log/postgresql/postgresql-16-main.log | tail -n 20
```

*–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø–∏—Å–µ–π –≤ –ª–æ–≥–µ —Å –∑–∞–ø—Ä–æ—Å–∞–º–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è pgbench, –æ—Ç–æ–±—Ä–∞–∂—ë–Ω—ã –≤ –æ—Ç—á—ë—Ç–µ.*

---

### 4.7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞ (–ü—É–Ω–∫—Ç—ã 1.6, 1.7)

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
–°–æ–∑–¥–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `replicator` —Å –ø—Ä–∞–≤–æ–º `REPLICATION`.

```sql
CREATE USER replicator WITH REPLICATION ENCRYPTED PASSWORD '...';
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (pg_hba.conf)
–í —Ñ–∞–π–ª `pg_hba.conf` –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞, —Ä–∞–∑—Ä–µ—à–∞—é—â–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ (`192.168.122.0/24`) –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `replicator` –∏ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

```text
host    replication     replicator    192.168.122.0/24       scram-sha-256
host    all             all           192.168.122.0/24       scram-sha-256
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ —Å –¥—Ä—É–≥–æ–π –≤–∏—Ä—Ç—É–∞–ª–∫–∏
–í—ã–ø–æ–ª–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ `server2` (192.168.122.75) –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ `server1` (192.168.122.19).

![alt text](image.png)
*–£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ psql —Å server2 –∫ server1.*

---

## 5. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Ansible

–í—Å–µ —ç—Ç–∞–ø—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —Å –ø–æ–º–æ—â—å—é playbook `postgresql_task1.yml`.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–¥–∞—á:**
1.  **Pre-check:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–ª—É–∂–±—ã PostgreSQL.
2.  **DB & User:** –°–æ–∑–¥–∞–Ω–∏–µ –ë–î `bench` –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `pgbench`.
3.  **Extensions:** –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–∞ contrib –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è `pg_stat_statements`.
4.  **Config:** –ò–∑–º–µ–Ω–µ–Ω–∏–µ `postgresql.conf` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–ª—É–∂–±—ã.
5.  **Benchmark:** –ó–∞–ø—É—Å–∫ `pgbench`.
6.  **Report:** –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ `pg_stat_statements` –∏ –ª–æ–≥–æ–≤.
7.  **Replication:** –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `pg_hba.conf`.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞:**
```bash
ansible-playbook -i inventory.ini postgresql_task1.yml --ask-vault-pass
```

Playbook —è–≤–ª—è–µ—Ç—Å—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º: –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ –ª–æ–º–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, –∞ –ª–∏—à—å –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

---

## 6. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–í —Ö–æ–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ –æ—Ç—á–µ—Ç–∞ –±—ã–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–∏–º–µ—Ä–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è):

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **TPS (Transactions Per Second)** | ~XXX (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ—Å—É—Ä—Å–æ–≤ VM) |
| **–°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ (Latency)** | ~X.X ms |
| **–°–∞–º—ã–π —Ç—è–∂–µ–ª—ã–π –∑–∞–ø—Ä–æ—Å (IO)** | `UPDATE pgbench_accounts SET abalance = ...` |
| **–°–∞–º—ã–π –¥–æ–ª–≥–∏–π –∑–∞–ø—Ä–æ—Å (Time)** | `INSERT INTO pgbench_history ...` |
| **–°—Ç–∞—Ç—É—Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏** | –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ |

---
`–†–µ–∑—É–ª—å—Ç–∞—Ç—ã pgbench`
```
pgbench (16.12 (Debian 16.12-1.pgdg13+1))
transaction type: <builtin: TPC-B (sort of)>
scaling factor: 10
query mode: simple
number of clients: 2
number of threads: 1
maximum number of tries: 1
number of transactions per client: 50
number of transactions actually processed: 100/100
number of failed transactions: 0 (0.000%)
latency average = 1.651 ms
initial connection time = 4.683 ms
tps = 1211.343016 (without initial connection time)
```
---

## 7. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í —Ä–∞–º–∫–∞—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è **Task_1** –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ —Ç—Ä–µ–±—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- ‚úÖ –†–∞–∑–≤–µ—Ä–Ω—É—Ç–∞ —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º `pgbench`.
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–¥—É–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ `pg_stat_statements`.
- ‚úÖ –í–∫–ª—é—á–µ–Ω–æ –ø–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤.
- ‚úÖ –ü—Ä–æ–≤–µ–¥–µ–Ω–æ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤—ã—è–≤–ª–µ–Ω—ã —É–∑–∫–∏–µ –º–µ—Å—Ç–∞.
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω —Å–µ—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø –º–µ–∂–¥—É —É–∑–ª–∞–º–∏.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Ansible –ø–æ–∑–≤–æ–ª–∏–ª–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –±—ã—Å—Ç—Ä–æ, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ –∏ –±–µ–∑ –æ—à–∏–±–æ–∫ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –ø–æ—Ç–æ–∫–æ–≤–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.

---

*–û—Ç—á–µ—Ç –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Ansible Playbook* 

---
*–î–∞—Ç–∞: 2026 | –ê–≤—Ç–æ—Ä: –¢–æ–≤–ø–µ–∫–æ –ì–ª–µ–± –í–∞–¥–∏–º–æ–≤–∏—á (@glebffff, telegram)* 
